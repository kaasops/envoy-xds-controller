# –ê–Ω–∞–ª–∏–∑ –ø–∞–∫–µ—Ç–∞ internal/xds/resbuilder –∏ –ø–ª–∞–Ω –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

*–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞: 16 —Å–µ–Ω—Ç—è–±—Ä—è 2025*

## –û–±–∑–æ—Ä –ø–∞–∫–µ—Ç–∞

–ü–∞–∫–µ—Ç `internal/xds/resbuilder` —è–≤–ª—è–µ—Ç—Å—è –∫–ª—é—á–µ–≤—ã–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º Envoy XDS Controller, –æ—Ç–≤–µ—á–∞—é—â–∏–º –∑–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ Envoy –∏–∑ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π VirtualService. –ü–∞–∫–µ—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —Ñ–∞–π–ª–æ–≤:

- `builder.go` (1,238 —Å—Ç—Ä–æ–∫) - –æ—Å–Ω–æ–≤–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- `builder_test.go` (338 —Å—Ç—Ä–æ–∫) - —Ç–µ—Å—Ç—ã

## –û–ø–∏—Å–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—É–±–ª–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

1. **`BuildResources`** (—Å—Ç—Ä–æ–∫–∏ 63-102)
   - **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ì–ª–∞–≤–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≤—Å–µ—Ö Envoy —Ä–µ—Å—É—Ä—Å–æ–≤ –∏–∑ VirtualService
   - **–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**: `*v1alpha1.VirtualService`, `*store.Store`
   - **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: `*Resources`, `error`
   - **–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**: –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤

### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤

2. **`applyVirtualServiceTemplate`** (—Å—Ç—Ä–æ–∫–∏ 105-125)
   - **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ –∫ VirtualService
   - **–ü—Ä–æ–±–ª–µ–º—ã**: –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞, –¥–∞–∂–µ –µ—Å–ª–∏ —à–∞–±–ª–æ–Ω –Ω–µ —É–∫–∞–∑–∞–Ω

3. **`buildResourcesFromVirtualService`** (—Å—Ç—Ä–æ–∫–∏ 217-271)
   - **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –∏–∑ –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ VirtualService
   - **–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**: –°–ª–∏—à–∫–æ–º —à–∏—Ä–æ–∫–∞—è - –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –≤—Å–µ –∞—Å–ø–µ–∫—Ç—ã –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è

4. **`buildResourcesFromExistingFilterChains`** (—Å—Ç—Ä–æ–∫–∏ 128-149)
   - **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö filter chains

### –§—É–Ω–∫—Ü–∏–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

5. **`buildListener`** (—Å—Ç—Ä–æ–∫–∏ 397-408)
   - **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω–∏–µ Envoy Listener
   
6. **`buildVirtualHost`** (—Å—Ç—Ä–æ–∫–∏ 410-471)
   - **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Ö–æ—Å—Ç–∞ —Å –º–∞—Ä—à—Ä—É—Ç–∞–º–∏

7. **`buildHTTPFilters`** (—Å—Ç—Ä–æ–∫–∏ 473-545)
   - **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ HTTP —Ñ–∏–ª—å—Ç—Ä–æ–≤
   - **–ü—Ä–æ–±–ª–µ–º—ã**: –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏ router —Ñ–∏–ª—å—Ç—Ä–∞

8. **`buildClusters`** (—Å—Ç—Ä–æ–∫–∏ 547-579)
   - **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
   - **–ü—Ä–æ–±–ª–µ–º—ã**: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã —Ñ—É–Ω–∫—Ü–∏–π —Å –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π –ª–æ–≥–∏–∫–æ–π

9. **`buildFilterChains`** (—Å—Ç—Ä–æ–∫–∏ 773-808)
   - **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω–∏–µ filter chains –¥–ª—è listener

10. **`buildSecrets`** (—Å—Ç—Ä–æ–∫–∏ 1063-1115)
    - **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ TLS —Å–µ–∫—Ä–µ—Ç–æ–≤ –∏–∑ Kubernetes —Å–µ–∫—Ä–µ—Ç–æ–≤

### –§—É–Ω–∫—Ü–∏–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤

11. **`clustersFromVirtualHostRoutes`** (—Å—Ç—Ä–æ–∫–∏ 582-604)
12. **`clustersFromOAuth2HTTPFilters`** (—Å—Ç—Ä–æ–∫–∏ 607-634)  
13. **`clustersFromTracingRaw`** (—Å—Ç—Ä–æ–∫–∏ 637-666)
14. **`clustersFromTracingRef`** (—Å—Ç—Ä–æ–∫–∏ 669-702)
    - **–ü—Ä–æ–±–ª–µ–º–∞**: –í—Å–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω—É—é –ª–æ–≥–∏–∫—É JSON marshal/unmarshal

### –£—Ç–∏–ª–∏—Ç–∞—Ä–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

15. **`findClusterNames`** (—Å—Ç—Ä–æ–∫–∏ 1043-1061)
16. **`findSDSNames`** (—Å—Ç—Ä–æ–∫–∏ 1117-1135)
    - **–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ—á—Ç–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∫–æ–¥–∞

17. **`checkFilterChainsConflicts`** (—Å—Ç—Ä–æ–∫–∏ 152-179)
    - **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    - **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–∞–π—Å–æ–≤

## –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –¥–µ—Ñ–µ–∫—Ç—ã –∏ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**1.1 –ú–æ–Ω–æ–ª–∏—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**
- –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –Ω–∞ 1,238 —Å—Ç—Ä–æ–∫ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–µ–π
- –°–º–µ—à–µ–Ω–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–æ–Ω—Ü–µ—Ä–Ω–æ–≤ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
- –ó–∞—Ç—Ä—É–¥–Ω–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**1.2 –ù–∏–∑–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏**
- –¢–æ–ª—å–∫–æ 7 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è 33 —Ñ—É–Ω–∫—Ü–∏–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (~21% –ø–æ–∫—Ä—ã—Ç–∏–µ)
- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π: `BuildResources`, `buildListener`, `buildClusters`

### 2. –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**2.1 –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏**
```go
// –ü—Ä–æ–±–ª–µ–º–∞: —Å–æ–∑–¥–∞–Ω–∏–µ –ø—É—Å—Ç—ã—Ö —Å–ª–∞–π—Å–æ–≤ —Å –ø–æ—Å–ª–µ–¥—É—é—â–∏–º —Ä–æ—Å—Ç–æ–º
clusters := make([]*cluster.Cluster, 0)
// –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ append –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–µ–∑ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–ª–ª–æ–∫–∞—Ü–∏–∏
clusters = append(clusters, routeClusters...)
```

**2.2 –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ JSON –æ–ø–µ—Ä–∞—Ü–∏–∏**
```go
// –ü—Ä–æ–±–ª–µ–º–∞: –Ω–µ–Ω—É–∂–Ω—ã–π —Ü–∏–∫–ª marshal -> unmarshal –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏–º–µ–Ω –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
jsonData, err := json.Marshal(route)
if err != nil {
    return nil, err
}
var data any
if err := json.Unmarshal(jsonData, &data); err != nil {
    return nil, err
}
```

**2.3 –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏**
```go
// –ü—Ä–æ–±–ª–µ–º–∞: ValidateAll() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ä–∞–∑ –±–µ–∑ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
if err := hf.ValidateAll(); err != nil {
    return nil, fmt.Errorf("failed to validate http filter: %w", err)
}
```

**2.4 –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**
```go
// –ü—Ä–æ–±–ª–µ–º–∞: strings.ReplaceAll –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
StatPrefix: strings.ReplaceAll(nn.String(), ".", "-"),
```

### 3. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

**3.1 –ò–¥–µ–Ω—Ç–∏—á–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤**
- –§—É–Ω–∫—Ü–∏–∏ `clustersFromVirtualHostRoutes`, `clustersFromOAuth2HTTPFilters`, `clustersFromTracingRaw` –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω—É—é –ª–æ–≥–∏–∫—É
- JSON marshal/unmarshal/–ø–æ–∏—Å–∫ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è 4 —Ä–∞–∑–∞

**3.2 –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–∏—Å–∫–∞**
- `findClusterNames` –∏ `findSDSNames` –∏–º–µ—é—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
- –†–∞–∑–ª–∏—á–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—è

### 4. –ü—Ä–æ–±–ª–µ–º—ã —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫

**4.1 –ù–µ–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±–æ—Ä–∞—á–∏–≤–∞—é—Ç –æ—à–∏–±–∫–∏, –¥—Ä—É–≥–∏–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –∫–∞–∫ –µ—Å—Ç—å
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

**4.2 –°–ª–æ–∂–Ω—ã–µ —Ü–µ–ø–æ—á–∫–∏ –æ—à–∏–±–æ–∫**
- `buildResourcesFromVirtualService` –∏–º–µ–µ—Ç 7+ —Ç–æ—á–µ–∫ –≤–æ–∑–≤—Ä–∞—Ç–∞ –æ—à–∏–±–æ–∫
- –ó–∞—Ç—Ä—É–¥–Ω–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### 5. –ú–∞–≥–∏—á–µ—Å–∫–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

```go
// –ü—Ä–æ–±–ª–µ–º—ã: –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ä–∞–∑–±—Ä–æ—Å–∞–Ω—ã –ø–æ –∫–æ–¥—É
Status: 421,  // HTTP —Å—Ç–∞—Ç—É—Å
Name: "421vh", // –∏–º—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Ö–æ—Å—Ç–∞
"exc.filters.http.rbac", // –∏–º—è —Ñ–∏–ª—å—Ç—Ä–∞
"type.googleapis.com/envoy.extensions.filters.http.oauth2.v3.OAuth2" // type URL
```

### 6. –°–ª–æ–∂–Ω–æ—Å—Ç—å –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞

**6.1 –ì–ª—É–±–æ–∫–∞—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å**
- –§—É–Ω–∫—Ü–∏–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ if/else
- –°–ª–æ–∂–Ω–æ —Å–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∏–∫–æ–π –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**6.2 –°–º–µ—à–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–µ–π**
- –§—É–Ω–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é, –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

## –ü–ª–∞–Ω –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏ —É–ª—É—á—à–µ–Ω–∏—è

### –≠—Ç–∞–ø 1: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –í—ã—Å–æ–∫–∏–π)

**1.1 –ú–æ–¥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è –ø–∞–∫–µ—Ç–∞**
```
internal/xds/resbuilder/
‚îú‚îÄ‚îÄ builder.go          // –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ listener/           
‚îÇ   ‚îú‚îÄ‚îÄ builder.go      // –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ listener
‚îÇ   ‚îî‚îÄ‚îÄ filter_chains.go // –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ filter chains
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îú‚îÄ‚îÄ virtual_host.go // –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ virtual host
‚îÇ   ‚îî‚îÄ‚îÄ route_config.go // –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ route configuration
‚îú‚îÄ‚îÄ clusters/
‚îÇ   ‚îú‚îÄ‚îÄ builder.go      // –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ extractor.go    // –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–º–µ–Ω –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ filters/
‚îÇ   ‚îú‚îÄ‚îÄ http_filters.go // HTTP —Ñ–∏–ª—å—Ç—Ä—ã
‚îÇ   ‚îî‚îÄ‚îÄ rbac.go         // RBAC –ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ secrets/
‚îÇ   ‚îú‚îÄ‚îÄ builder.go      // –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ converter.go    // –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è Kubernetes -> Envoy
‚îî‚îÄ‚îÄ utils/
    ‚îú‚îÄ‚îÄ constants.go    // –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
    ‚îú‚îÄ‚îÄ validators.go   // –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã
    ‚îî‚îÄ‚îÄ helpers.go      // –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
```

**1.2 –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤**
```go
type ClusterBuilder interface {
    BuildClusters(vs *v1alpha1.VirtualService, virtualHost *routev3.VirtualHost, httpFilters []*hcmv3.HttpFilter) ([]*cluster.Cluster, error)
}

type SecretBuilder interface {
    BuildSecrets(httpFilters []*hcmv3.HttpFilter, secretNameToDomains map[helpers.NamespacedName][]string) ([]*tlsv3.Secret, []helpers.NamespacedName, error)
}
```

### –≠—Ç–∞–ø 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –í—ã—Å–æ–∫–∏–π)

**2.1 –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞**
```go
// –°–æ–∑–¥–∞–Ω–∏–µ –µ–¥–∏–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
type ClusterExtractor struct {
    store *store.Store
}

func (ce *ClusterExtractor) ExtractClusters(data interface{}, fieldNames ...string) ([]*cluster.Cluster, error) {
    // –ï–¥–∏–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö —Å–ª—É—á–∞–µ–≤ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
}
```

**2.2 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏**
```go
// –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–ª–ª–æ–∫–∞—Ü–∏—è —Å–ª–∞–π—Å–æ–≤
func buildClusters(vs *v1alpha1.VirtualService, virtualHost *routev3.VirtualHost, httpFilters []*hcmv3.HttpFilter, store *store.Store) ([]*cluster.Cluster, error) {
    // –û—Ü–µ–Ω–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
    estimatedSize := len(virtualHost.Routes) + len(httpFilters) + 2
    clusters := make([]*cluster.Cluster, 0, estimatedSize)
    // ...
}
```

**2.3 –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö JSON –æ–ø–µ—Ä–∞—Ü–∏–π**
```go
// –ü—Ä—è–º–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –ø–æ–ª—è–º —Å—Ç—Ä—É–∫—Ç—É—Ä –≤–º–µ—Å—Ç–æ JSON –æ–ø–µ—Ä–∞—Ü–∏–π
func extractClusterNamesFromRoute(route *routev3.Route) []string {
    var names []string
    if weightedClusters := route.GetRoute().GetWeightedClusters(); weightedClusters != nil {
        for _, cluster := range weightedClusters.Clusters {
            names = append(names, cluster.Name)
        }
    } else if cluster := route.GetRoute().GetCluster(); cluster != "" {
        names = append(names, cluster)
    }
    return names
}
```

**2.4 –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏**
```go
type ValidationCache struct {
    validated map[string]bool
    mu        sync.RWMutex
}

func (vc *ValidationCache) IsValidated(key string) bool {
    vc.mu.RLock()
    defer vc.mu.RUnlock()
    return vc.validated[key]
}
```

### –≠—Ç–∞–ø 3: –£–ª—É—á—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –°—Ä–µ–¥–Ω–∏–π)

**3.1 –°–æ–∑–¥–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫**
```go
type BuildError struct {
    Component string
    Operation string
    Err       error
}

func (e *BuildError) Error() string {
    return fmt.Sprintf("failed to %s %s: %v", e.Operation, e.Component, e.Err)
}
```

**3.2 –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
```go
type ErrorHandler struct {
    logger logr.Logger
}

func (eh *ErrorHandler) HandleBuildError(component, operation string, err error) error {
    buildErr := &BuildError{
        Component: component,
        Operation: operation,
        Err:       err,
    }
    eh.logger.Error(buildErr, "Build operation failed")
    return buildErr
}
```

### –≠—Ç–∞–ø 4: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –°—Ä–µ–¥–Ω–∏–π)

**4.1 –§–∞–π–ª –∫–æ–Ω—Å—Ç–∞–Ω—Ç**
```go
// internal/xds/resbuilder/utils/constants.go
const (
    // HTTP —Å—Ç–∞—Ç—É—Å—ã
    HTTPStatusMisdirectedRequest = 421
    
    // –ò–º–µ–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
    RBACFilterName   = "exc.filters.http.rbac"
    RouterFilterName = "envoy.filters.http.router"
    
    // Type URLs
    OAuth2FilterTypeURL = "type.googleapis.com/envoy.extensions.filters.http.oauth2.v3.OAuth2"
    RouterFilterTypeURL = "type.googleapis.com/envoy.extensions.filters.http.router.v3.Router"
    TCPProxyTypeURL     = "type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy"
    
    // –ò–º–µ–Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —Ö–æ—Å—Ç–æ–≤
    FallbackVirtualHostName = "fallback_421_vh"
)
```

### –≠—Ç–∞–ø 5: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –í—ã—Å–æ–∫–∏–π)

**5.1 –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤**
```go
func TestBuildResources_Integration(t *testing.T) {
    // –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
}

func TestBuildClusters_AllSources(t *testing.T) {
    // –¢–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
}

func TestPerformance_LargeVirtualService(t *testing.T) {
    // –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
}
```

**5.2 –ë–µ–Ω—á–º–∞—Ä–∫–∏**
```go
func BenchmarkBuildResources(b *testing.B) {
    // –ë–µ–Ω—á–º–∞—Ä–∫–∏ –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
}

func BenchmarkClusterExtraction(b *testing.B) {
    // –ë–µ–Ω—á–º–∞—Ä–∫–∏ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
}
```

### –≠—Ç–∞–ø 6: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ù–∏–∑–∫–∏–π)

**6.1 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫**
```go
var (
    buildDuration = prometheus.NewHistogramVec(
        prometheus.HistogramOpts{
            Name: "resbuilder_build_duration_seconds",
            Help: "Duration of resource building operations",
        },
        []string{"operation", "status"},
    )
    
    resourceCount = prometheus.NewGaugeVec(
        prometheus.GaugeOpts{
            Name: "resbuilder_resources_built_total",
            Help: "Total number of resources built",
        },
        []string{"resource_type"},
    )
)
```

## –°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–∞

–î–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —É–ª—É—á—à–µ–Ω–∏–π –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –æ—Ç—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ø–∞–∫–µ—Ç–∞ `internal/xds/resbuilder` —Å –ø–æ—Å–ª–µ–¥—É—é—â–∏–º –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–º —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º —Å—Ç–∞—Ä–æ–π –∏ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–π.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

```
internal/xds/
‚îú‚îÄ‚îÄ resbuilder/           # —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (legacy)
‚îÇ   ‚îú‚îÄ‚îÄ builder.go
‚îÇ   ‚îî‚îÄ‚îÄ builder_test.go
‚îî‚îÄ‚îÄ resbuilder_v2/        # –Ω–æ–≤–∞—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
    ‚îú‚îÄ‚îÄ builder.go        # –≥–ª–∞–≤–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä
    ‚îú‚îÄ‚îÄ interfaces/       
    ‚îÇ   ‚îî‚îÄ‚îÄ interfaces.go # –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
    ‚îú‚îÄ‚îÄ listener/         
    ‚îÇ   ‚îú‚îÄ‚îÄ builder.go    
    ‚îÇ   ‚îî‚îÄ‚îÄ filter_chains.go
    ‚îú‚îÄ‚îÄ routes/
    ‚îÇ   ‚îú‚îÄ‚îÄ virtual_host.go
    ‚îÇ   ‚îî‚îÄ‚îÄ route_config.go
    ‚îú‚îÄ‚îÄ clusters/
    ‚îÇ   ‚îú‚îÄ‚îÄ builder.go    
    ‚îÇ   ‚îî‚îÄ‚îÄ extractor.go  
    ‚îú‚îÄ‚îÄ filters/
    ‚îÇ   ‚îú‚îÄ‚îÄ http_filters.go
    ‚îÇ   ‚îî‚îÄ‚îÄ rbac.go       
    ‚îú‚îÄ‚îÄ secrets/
    ‚îÇ   ‚îú‚îÄ‚îÄ builder.go    
    ‚îÇ   ‚îî‚îÄ‚îÄ converter.go  
    ‚îú‚îÄ‚îÄ utils/
    ‚îÇ   ‚îú‚îÄ‚îÄ constants.go  
    ‚îÇ   ‚îú‚îÄ‚îÄ validators.go 
    ‚îÇ   ‚îî‚îÄ‚îÄ helpers.go    
    ‚îî‚îÄ‚îÄ tests/
        ‚îú‚îÄ‚îÄ integration_test.go
        ‚îú‚îÄ‚îÄ benchmark_test.go
        ‚îî‚îÄ‚îÄ comparison_test.go
```

### –≠—Ç–∞–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–≠—Ç–∞–ø A: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (1-2 –¥–Ω—è)**
1. –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–∫–µ—Ç–∞ `resbuilder_v2`
2. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∏ –±–∞–∑–æ–≤—ã—Ö —Ç–∏–ø–æ–≤
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

**–≠—Ç–∞–ø B: –ü–æ—ç—Ç–∞–ø–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (1-2 –Ω–µ–¥–µ–ª–∏)**
1. –ú–∏–≥—Ä–∞—Ü–∏—è —É—Ç–∏–ª–∏—Ç–∞—Ä–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
2. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
3. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤
4. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π —Ñ–∏–ª—å—Ç—Ä–æ–≤
5. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π listener –∏ routes
6. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**–≠—Ç–∞–ø C: –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (3-5 –¥–Ω–µ–π)**
1. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ—Å—Ç–æ–≤ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç–∏
2. –°–æ–∑–¥–∞–Ω–∏–µ –±–µ–Ω—á–º–∞—Ä–∫–æ–≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–µ—Ç—Ä–∏–∫ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

**1. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç—å**
```go
func TestEquivalence_BuildResources(t *testing.T) {
    testCases := []struct {
        name string
        vs   *v1alpha1.VirtualService
        store *store.Store
    }{
        // –†–∞–∑–ª–∏—á–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ VirtualService
    }
    
    for _, tc := range testCases {
        t.Run(tc.name, func(t *testing.T) {
            // –†–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏
            resultOld, errOld := resbuilder.BuildResources(tc.vs, tc.store)
            
            // –†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏
            resultNew, errNew := resbuilder_v2.BuildResources(tc.vs, tc.store)
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            assert.Equal(t, errOld != nil, errNew != nil)
            if errOld == nil && errNew == nil {
                assert.True(t, resourcesEqual(resultOld, resultNew))
            }
        })
    }
}

func resourcesEqual(old, new *Resources) bool {
    // –ì–ª—É–±–æ–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ —Å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π
    return deepCompareResources(old, new)
}
```

**2. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
```go
func BenchmarkComparison_BuildResources(b *testing.B) {
    testData := setupBenchmarkData()
    
    b.Run("Legacy", func(b *testing.B) {
        for i := 0; i < b.N; i++ {
            _, err := resbuilder.BuildResources(testData.vs, testData.store)
            if err != nil {
                b.Fatal(err)
            }
        }
    })
    
    b.Run("V2", func(b *testing.B) {
        for i := 0; i < b.N; i++ {
            _, err := resbuilder_v2.BuildResources(testData.vs, testData.store)
            if err != nil {
                b.Fatal(err)
            }
        }
    })
}

func BenchmarkMemoryUsage(b *testing.B) {
    // –ò–∑–º–µ—Ä–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
    testData := setupBenchmarkData()
    
    b.Run("Legacy_Memory", func(b *testing.B) {
        b.ReportAllocs()
        for i := 0; i < b.N; i++ {
            _, _ = resbuilder.BuildResources(testData.vs, testData.store)
        }
    })
    
    b.Run("V2_Memory", func(b *testing.B) {
        b.ReportAllocs()
        for i := 0; i < b.N; i++ {
            _, _ = resbuilder_v2.BuildResources(testData.vs, testData.store)
        }
    })
}
```

### –ù–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**1. –ü—Ä–æ—Å—Ç—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
- –ë–∞–∑–æ–≤—ã–π VirtualService –±–µ–∑ TLS
- VirtualService —Å –æ–¥–Ω–∏–º –º–∞—Ä—à—Ä—É—Ç–æ–º
- VirtualService —Å –±–∞–∑–æ–≤—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏

**2. –°–ª–æ–∂–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
- VirtualService —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –¥–æ–º–µ–Ω–∞–º–∏
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å TLS –∏ –∞–≤—Ç–æ–¥–∏—Å–∫–∞–≤–µ—Ä–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤
- VirtualService —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ HTTP —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å OAuth2 –∏ RBAC

**3. –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏**
- –ë–æ–ª—å—à–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (50+ –º–∞—Ä—à—Ä—É—Ç–æ–≤)
- –í–ª–æ–∂–µ–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã VirtualService
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ä–µ—Å—É—Ä—Å—ã

### –ú–µ—Ç—Ä–∏–∫–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

**1. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
```go
type PerformanceMetrics struct {
    ExecutionTime    time.Duration
    MemoryAllocated  int64
    MemoryAllocations int64
    GCPauses         []time.Duration
    CPUTime          time.Duration
}

func CollectMetrics(fn func()) *PerformanceMetrics {
    // –°–±–æ—Ä –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
}
```

**2. –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏**
- –¶–∏–∫–ª–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–π
- –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞ —Ç–µ—Å—Ç–∞–º–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞–∫–µ—Ç–æ–≤ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –ü–ª–∞–Ω –≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–§–∞–∑–∞ 1: –ú–æ–¥—É–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ)**
```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç–∏
go test ./internal/xds/resbuilder_v2/tests -run TestEquivalence

# –ë–µ–Ω—á–º–∞—Ä–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
go test ./internal/xds/resbuilder_v2/tests -bench BenchmarkComparison -benchmem
```

**–§–∞–∑–∞ 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è (–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ)**
```bash
# –ü–æ–ª–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
go test ./internal/xds/resbuilder_v2/tests -run TestIntegration

# –¢–µ—Å—Ç—ã –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –Ω–∞–≥—Ä—É–∑–∫–∞–º–∏  
go test ./internal/xds/resbuilder_v2/tests -bench BenchmarkLoad -benchtime=30s
```

**–§–∞–∑–∞ 3: –ü—Ä–∏–µ–º–æ—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è**
```bash
# –§–∏–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø–µ—Ä–µ–¥ –∑–∞–º–µ–Ω–æ–π
go test ./internal/xds/resbuilder_v2/tests -run TestFinal
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- ‚úÖ 100% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- ‚úÖ –ù–µ –º–µ–Ω–µ–µ 95% –ø–æ–∫—Ä—ã—Ç–∏—è —Ç–µ—Å—Ç–∞–º–∏
- ‚úÖ –í—Å–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- ‚ö° –£–ª—É—á—à–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –Ω–∞ 20%+ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å–æ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–µ–π
- üß† –°–Ω–∏–∂–µ–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –Ω–∞ 15%+ 
- üìà –£–º–µ–Ω—å—à–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∞–ª–ª–æ–∫–∞—Ü–∏–π –Ω–∞ 25%+

**–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:**
- üìä –°–Ω–∏–∂–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–π —Ü–∏–∫–ª–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –¥–æ < 10
- üîß –£–ª—É—á—à–µ–Ω–∏–µ –ø–æ–∫—Ä—ã—Ç–∏—è —Ç–µ—Å—Ç–∞–º–∏ –¥–æ 85%+
- üìö –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤—Å–µ—Ö –ø—É–±–ª–∏—á–Ω—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏

**–≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—é**
1. –°–æ–∑–¥–∞–Ω–∏–µ feature flag –¥–ª—è –≤—ã–±–æ—Ä–∞ –≤–µ—Ä—Å–∏–∏ resbuilder
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞–ª–µ—Ä—Ç–æ–≤
3. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ rollback –ø—Ä–æ—Ü–µ–¥—É—Ä—ã

**–≠—Ç–∞–ø 2: –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ**
```go
// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
type Config struct {
    UseResbuilderV2 bool `yaml:"use_resbuilder_v2"`
}

// –£—Å–ª–æ–≤–Ω—ã–π –≤—ã–∑–æ–≤ –≤ –∫–æ–¥–µ
func (c *Controller) buildResources(vs *v1alpha1.VirtualService) (*Resources, error) {
    if c.config.UseResbuilderV2 {
        return resbuilder_v2.BuildResources(vs, c.store)
    }
    return resbuilder.BuildResources(vs, c.store)
}
```

**–≠—Ç–∞–ø 3: –§–∏–Ω–∞–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è**
1. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –≤ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–µ
2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
3. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω —Å –≥—Ä–∞–¥—É–∞–ª—å–Ω—ã–º —Ä–æ–ª–ª–∞—É—Ç–æ–º
4. –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥–∞ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

## –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–£–ª—É—á—à–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏**: —Å–Ω–∏–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ –Ω–∞ 30-50%
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏**: —Å–Ω–∏–∂–µ–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –Ω–∞ 20-30%
- **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —É—Ç–µ—á–µ–∫**: –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
- **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏**: —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –¥–æ 80%+ 
- **–¶–∏–∫–ª–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å**: —Å–Ω–∏–∂–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–π
- **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å**: —É–ª—É—á—à–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –ø–æ–Ω–∏–º–∞–Ω–∏—è –∫–æ–¥–∞

### –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ
- **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**: —É–ø—Ä–æ—â–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- **–û—Ç–ª–∞–¥–∫–∞**: —É–ª—É—á—à–µ–Ω–∏–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: —É–ª—É—á—à–µ–Ω–∏–µ –ø–æ–Ω–∏–º–∞–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ) - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
1. **–≠—Ç–∞–ø A: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã** (1-2 –¥–Ω—è)
   - –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–∫–µ—Ç–∞ `resbuilder_v2`
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∏ –±–∞–∑–æ–≤—ã—Ö —Ç–∏–ø–æ–≤
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å –±–µ–Ω—á–º–∞—Ä–∫–∞–º–∏

2. **–≠—Ç–∞–ø B: –ü–æ—ç—Ç–∞–ø–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤** (1-2 –Ω–µ–¥–µ–ª–∏)
   - –ú–∏–≥—Ä–∞—Ü–∏—è —É—Ç–∏–ª–∏—Ç–∞—Ä–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π —Å —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
   - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
   - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤
   - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π —Ñ–∏–ª—å—Ç—Ä–æ–≤
   - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π listener –∏ routes
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

3. **–≠—Ç–∞–ø C: –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è** (3-5 –¥–Ω–µ–π)
   - –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ—Å—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç–∏
   - –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã—Ö –±–µ–Ω—á–º–∞—Ä–∫–æ–≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–µ—Ç—Ä–∏–∫ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (—Å–ª–µ–¥—É—é—â–∏–π —Å–ø—Ä–∏–Ω—Ç) - –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ
1. **–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**
   - –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç–∏
   - –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
   - –ò–∑–º–µ—Ä–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

2. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –º–∏–≥—Ä–∞—Ü–∏–∏**
   - –°–æ–∑–¥–∞–Ω–∏–µ feature flag –¥–ª—è –≤—ã–±–æ—Ä–∞ –≤–µ—Ä—Å–∏–∏
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞–ª–µ—Ä—Ç–æ–≤
   - –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ rollback –ø—Ä–æ—Ü–µ–¥—É—Ä—ã

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏)
1. **–§–∏–Ω–∞–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è**
   - –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º
   - –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥–∞ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
2. **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è**
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –º–µ—Ç—Ä–∏–∫
   - –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥—Ä–æ–±–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
   - –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü–∞–∫–µ—Ç `internal/xds/resbuilder` —Ç—Ä–µ–±—É–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç–∏ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏. –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å–≤—è–∑–∞–Ω—ã —Å –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π, –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∫–æ–¥–∞, –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–∞–º—è—Ç–∏ –∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º —Ç–µ—Å—Ç–æ–≤—ã–º –ø–æ–∫—Ä—ã—Ç–∏–µ–º.

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏** –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ–¥—Ö–æ–¥–∞:

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω–æ–π –≤–æ –≤—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ –±–µ–Ω—á–º–∞—Ä–∫–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –æ–±—ä–µ–∫—Ç–∏–≤–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
3. **–ö–∞—á–µ—Å—Ç–≤–æ**: –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç—å –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
4. **–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ—Å—Ç—å**: Feature flag –ø–æ–∑–≤–æ–ª—è–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:

- ‚úÖ **100% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç—å** - –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –¥–∞–µ—Ç —Ç–∞–∫–æ–π –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- ‚ö° **–£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ 20%+** - –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ
- üß† **–°–Ω–∏–∂–µ–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –Ω–∞ 15%+** - –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ  
- üîß **–ü–æ–≤—ã—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞** - –ª—É—á—à–∞—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å

–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–π –ø–ª–∞–Ω —Å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–º–∏ –±–µ–Ω—á–º–∞—Ä–∫–∞–º–∏ –ø–æ–∑–≤–æ–ª–∏—Ç –¥–æ—Å—Ç–∏—á—å –≤—Å–µ—Ö –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ü–µ–ª–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö —Ä–∏—Å–∫–∞—Ö –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã. –ü–æ—ç—Ç–∞–ø–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.